<!DOCTYPE html>
<html>
<head>
    <title>India Famous Architectures Map</title>
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 600px; width: 100%; }
        #zoomBox {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 9999;
            background: white;
            padding: 5px 12px;
            border: 1px solid #000;
            border-radius: 4px;
            font-weight: bold;
            user-select: none;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
        }
        .info {
            margin-top: 10px;
            font-size: 18px;
        }
        .label {
            font-weight: bold;
        }
    </style>
</head>
<body>

<div id="zoomBox">Zoom: 0%</div>
<div id="map"></div>

<div class="info">
    <span class="label">Selected Monument:</span>
    <span id="selectedMonument">None</span>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // **1. Smooth Zooming Control**
    const map = L.map('map', {
        zoomAnimation: true,
        easeLinearity: 0.5,
        // Zooming smoothness: reduced zoomDelta makes each zoom step smaller (e.g., 0.5 instead of 1)
        zoomDelta: 0.5, 
        zoomSnap: 0.5 // Ensures that small zoom steps are accepted
    }).setView([20.59, 78.96], 5);
    
    const maxZoom = 19;
    const minZoom = 5;

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom,
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const zoomBox = document.getElementById('zoomBox');
    const selectedMonumentEl = document.getElementById('selectedMonument');

    function zoomToPercent(zoom) {
        // Calculate the percentage of zoom level within the min/max range
        return Math.round(((zoom - minZoom) / (maxZoom - minZoom)) * 100);
    }

    function updateZoomBox() {
        const zoom = map.getZoom();
        zoomBox.innerText = 'Zoom: ' + zoomToPercent(zoom) + '%';
    }

    map.on('zoomend', () => {
        updateZoomBox();
        updateMarkersVisibility(); // Call visibility check on zoom end
    });

    updateZoomBox();

    // **Kodular Communication Function (Retained)**
    window.AcknowledgeSelection = function(title) {
        if (window.AppInventor) {
            // Sends the selected name to Kodular's Web Viewer string
            window.AppInventor.setWebViewString(title);
        } else {
            console.log("Selected monument sent to Kodular: " + title);
        }
    };
    
   const monuments = [
    // Uttar Pradesh
  { name: "Taj Mahal", lat: 27.1751, lng: 78.0421,
    img: "1.png" },
  { name: "Agra Fort", lat: 27.1795, lng: 78.0211,
    img: "2.jpg" }, 
  { name: "Fatehpur Sikri", lat: 27.0937, lng: 77.6600,
    img: "3.png" }, 
  { name: "Varanasi Ghats", lat: 25.3069, lng: 83.0093,
    img: "4.png" }, 
  { name: "Jhansi Fort", lat: 25.4580, lng: 78.5760,
    img: "5.png" }, 

  // Delhi
  { name: "Red Fort (Lal Qila)", lat: 28.6562, lng: 77.2410,
    img: "6.png" }, 
  { name: "Qutub Minar", lat: 28.5244, lng: 77.1855,
    img: "7.png" }, 
  { name: "Humayunâ€™s Tomb", lat: 28.5933, lng: 77.2507,
    img: "8.png" }, 
  { name: "India Gate", lat: 28.6129, lng: 77.2295,
    img: "9.png" }, 
  { name: "Lotus Temple", lat: 28.5535, lng: 77.2588,
    img: "10.png" },
  { name: "Jama Masjid Delhi", lat: 28.6507, lng: 77.2334,
    img: "11.png" },
  { name: "Jantar Mantar Delhi", lat: 28.6271, lng: 77.2166,
    img: "12.png" },

  // Rajasthan
  { name: "Hawa Mahal", lat: 26.9239, lng: 75.8267,
    img: "13.png" },
  { name: "Amer Fort", lat: 26.9855, lng: 75.8513,
    img: "14.png" },
  { name: "City Palace Jaipur", lat: 26.9260, lng: 75.8235,
    img: "15.png" },
  { name: "Jantar Mantar Jaipur", lat: 26.9248, lng: 75.8267,
    img: "16.jpeg" },
  { name: "Mehrangarh Fort", lat: 26.2980, lng: 73.0186,
    img: "18.png" },
  { name: "Umaid Bhawan Palace", lat: 26.2978, lng: 73.0479,
    img: "18.png" },
  { name: "Jaisalmer Fort", lat: 26.9124, lng: 70.9120,
    img: "19.jpg" },
  { name: "Chittorgarh Fort", lat: 24.8892, lng: 74.6463,
    img: "20.jpg" },
  { name: "Kumbhalgarh Fort", lat: 25.1473, lng: 73.5836,
    img: "21.png" },

  // Maharashtra
  { name: "Gateway of India", lat: 18.9220, lng: 72.8347,
    img: "22.png" },
  { name: "Chhatrapati Shivaji Maharaj Terminus", lat: 18.9398, lng: 72.8355,
    img: "23.png" },
  { name: "Elephanta Caves", lat: 18.9633, lng: 72.9316,
    img: "24.png" },
  { name: "Ajanta Caves", lat: 20.5520, lng: 75.7033,
    img: "25.jpeg" },
  { name: "Ellora Caves", lat: 20.0269, lng: 75.1770,
    img: "26.jpeg" },
  { name: "Shaniwar Wada", lat: 18.5195, lng: 73.8553,
    img: "27.png" },

  // West Bengal
  { name: "Victoria Memorial", lat: 22.5448, lng: 88.3426,
    img: "https://upload.wikimedia.org/wikipedia/commons/5/57/Victoria_Memorial%2C_Kolkata_2018-03-18_IMG_1535.jpg" }, // [web:25]
  { name: "Howrah Bridge", lat: 22.5850, lng: 88.3468,
    img: "https://upload.wikimedia.org/wikipedia/commons/0/04/Howrah_Bridge_at_night.jpg" }, // [web:37]
  { name: "Dakshineswar Kali Temple", lat: 22.6557, lng: 88.3568,
    img: "https://upload.wikimedia.org/wikipedia/commons/6/6c/Dakshineswar_Kali_Temple_2019.jpg" }, // [web:37]
  { name: "Belur Math", lat: 22.6325, lng: 88.3563,
    img: "https://upload.wikimedia.org/wikipedia/commons/3/3b/Belur_Math_Temple.jpg" }, // [web:37]

  // Tamil Nadu
  { name: "Meenakshi Amman Temple", lat: 9.9192, lng: 78.1198,
    img: "https://upload.wikimedia.org/wikipedia/commons/3/3a/Meenakshi_Temple_Towers_at_Night.jpg" }, // [web:25]
  { name: "Brihadeeswarar Temple (Thanjavur)", lat: 10.7850, lng: 79.1378,
    img: "https://upload.wikimedia.org/wikipedia/commons/0/0c/Brihadeeswarar_Temple_Thanjavur.jpg" }, // [web:33]
  { name: "Mahabalipuram Shore Temple", lat: 12.6160, lng: 80.1990,
    img: "https://upload.wikimedia.org/wikipedia/commons/9/99/Shore_Temple%2C_Mahabalipuram.jpg" }, // [web:33]
  { name: "Ramanathaswamy Temple Rameswaram", lat: 9.2881, lng: 79.3129,
    img: "https://upload.wikimedia.org/wikipedia/commons/6/6b/Ramanathaswamy_temple_corridor.jpg" }, // [web:37]

  // Karnataka
  { name: "Mysore Palace", lat: 12.3052, lng: 76.6551,
    img: "https://upload.wikimedia.org/wikipedia/commons/7/7c/Mysore_Palace_Bright_2011.JPG" }, // [web:25]
  { name: "Hampi Group of Monuments", lat: 15.3350, lng: 76.4600,
    img: "https://upload.wikimedia.org/wikipedia/commons/9/91/Virupaksha_Temple%2C_Hampi.jpg" }, // [web:33]
  { name: "Gol Gumbaz", lat: 16.8304, lng: 75.7390,
    img: "https://upload.wikimedia.org/wikipedia/commons/3/39/Gol_Gumbaz%2C_Bijapur.jpg" }, // [web:37]
  { name: "Badami Cave Temples", lat: 15.9149, lng: 75.6768,
    img: "https://upload.wikimedia.org/wikipedia/commons/1/1b/Badami_cave_temple_3.jpg" }, // [web:37]

  // Kerala
  { name: "Padmanabhaswamy Temple", lat: 8.4828, lng: 76.9431,
    img: "https://upload.wikimedia.org/wikipedia/commons/5/5c/Sree_Padmanabhaswamy_temple%2C_Tiruvananthapuram.jpg" }, // [web:37]
  { name: "Bekal Fort", lat: 12.3862, lng: 75.0349,
    img: "https://upload.wikimedia.org/wikipedia/commons/3/3a/Bekal_Fort_Kerala.jpg" }, // [web:37]
  { name: "Mattancherry Palace", lat: 9.9633, lng: 76.2425,
    img: "https://upload.wikimedia.org/wikipedia/commons/2/2c/Mattancherry_Palace.jpg" }, // [web:37]

  // Andhra Pradesh / Telangana
  { name: "Charminar", lat: 17.3616, lng: 78.4747,
    img: "https://upload.wikimedia.org/wikipedia/commons/4/4a/Charminar_03-2016_img2.jpg" }, // [web:25]
  { name: "Golconda Fort", lat: 17.3833, lng: 78.4011,
    img: "https://upload.wikimedia.org/wikipedia/commons/5/5f/Golconda_Fort%2C_Hyderabad.jpg" }, // [web:37]
  { name: "Thousand Pillar Temple (Warangal)", lat: 17.9726, lng: 79.5941,
    img: "https://upload.wikimedia.org/wikipedia/commons/8/82/Thousand_pillar_temple_warangal.jpg" }, // [web:37]
  { name: "Lepakshi Temple", lat: 13.8043, lng: 77.6092,
    img: "https://upload.wikimedia.org/wikipedia/commons/2/2a/Veerabhadra_Temple_Lepakshi.jpg" }, // [web:37]

  // Punjab / North
  { name: "Golden Temple Amritsar", lat: 31.6200, lng: 74.8765,
    img: "https://upload.wikimedia.org/wikipedia/commons/5/55/Golden_Temple_in_Amritsar_5.JPG" }, // [web:25]
  { name: "Jallianwala Bagh", lat: 31.6206, lng: 74.8790,
    img: "https://upload.wikimedia.org/wikipedia/commons/6/6c/Jallianwala_Bagh_Memorial.jpg" }, // [web:37]
  { name: "Rock Garden Chandigarh", lat: 30.7525, lng: 76.8100,
    img: "https://upload.wikimedia.org/wikipedia/commons/0/06/Rock_Garden_Chandigarh.jpg" }, // [web:37]

  // Gujarat
  { name: "Rani ki Vav Patan", lat: 23.8589, lng: 72.1010,
    img: "https://upload.wikimedia.org/wikipedia/commons/5/5f/Rani_ki_vav_09.jpg" }, // [web:33]
  { name: "Somnath Temple", lat: 20.8880, lng: 70.4012,
    img: "https://upload.wikimedia.org/wikipedia/commons/0/05/Somnath_temple.jpg" }, // [web:37]
  { name: "Sabarmati Ashram", lat: 23.0608, lng: 72.5800,
    img: "https://upload.wikimedia.org/wikipedia/commons/0/0f/Sabarmati_Ashram_Ahmedabad.jpg" }, // [web:37]
  { name: "Sun Temple Modhera", lat: 23.5925, lng: 72.1408,
    img: "https://upload.wikimedia.org/wikipedia/commons/6/6d/Sun_Temple%2C_Modhera.jpg" }, // [web:37]

  // Odisha
  { name: "Konark Sun Temple", lat: 19.8874, lng: 86.0940,
    img: "https://upload.wikimedia.org/wikipedia/commons/d/d3/Konark_Sun_Temple%2C_Odisha%2C_India.JPG" }, // [web:25]
  { name: "Jagannath Temple Puri", lat: 19.8048, lng: 85.8174,
    img: "https://upload.wikimedia.org/wikipedia/commons/7/7e/Jagannath_Temple%2C_Puri.jpg" }, // [web:37]

  // Bihar / MP
  { name: "Mahabodhi Temple Bodh Gaya", lat: 24.6961, lng: 84.9915,
    img: "https://upload.wikimedia.org/wikipedia/commons/b/bf/Mahabodhi_Temple%2C_Bodh_Gaya.jpg" }, // [web:33]
  { name: "Nalanda Mahavihara", lat: 25.1367, lng: 85.4433,
    img: "https://upload.wikimedia.org/wikipedia/commons/3/36/Nalanda_University_India_ruins.jpg" }, // [web:33]
  { name: "Sanchi Stupa", lat: 23.4863, lng: 77.7395,
    img: "https://upload.wikimedia.org/wikipedia/commons/4/4b/Sanchi_Stupa.jpg" } // [web:33]
];

    const markerObjects = [];

    function createImageMarker(lat, lng, imgURL, title) {
        const icon = L.icon({
            iconUrl: imgURL,
            iconSize: [45, 45],
            iconAnchor: [22, 45],
            popupAnchor: [0, -45]
        });

        const marker = L.marker([lat, lng], { icon, title });
        marker.bindPopup(`<b>${title}</b><br><img src="${imgURL}" alt="${title}" width="150" />`);
        
        marker.on('click', () => {
            selectedMonumentEl.innerText = title;
            window.AcknowledgeSelection(title); // Send data to Kodular
        });

        markerObjects.push(marker);
        // Do not add to map yet, visibility is controlled by updateMarkersVisibility()
    }

    monuments.forEach(m => {
        createImageMarker(m.lat, m.lng, m.img, m.name);
    });

    // **2. Marker Visibility Control (Re-added)**
    function updateMarkersVisibility() {
        const zoom = map.getZoom();
        const pct = zoomToPercent(zoom);
        const visibilityThreshold = 60; // 60% zoom required for markers

        markerObjects.forEach(marker => {
            if (pct >= visibilityThreshold) {
                // If zoom is >= 60% and marker is not on map, add it
                if (!map.hasLayer(marker)) {
                    marker.addTo(map);
                }
            } else {
                // If zoom is < 60% and marker is on map, remove it
                if (map.hasLayer(marker)) {
                    map.removeLayer(marker);
                }
            }
        });
    }

    // Initial call to set correct visibility
    updateMarkersVisibility();
</script>

</body>
</html>
